<html>

<head>
  <meta charset="UTF-8">
  <title>hinata_talk</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@100..900&display=swap" rel="stylesheet">
  <style>
  .norightclick {
    user-select: none;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    -webkit-touch-callout: none;
    pointer-events: auto;
  }
  
  .norightclick,
  .norightclick * {
    -webkit-user-drag: none;
    -khtml-user-drag: none;
    -moz-user-drag: none;
    -o-user-drag: none;
    user-drag: none;
  }
    .filter-white {
    filter: brightness(0) invert(1);
    }
    .filter-pink {
    filter:
      sepia(100%)
      saturate(600%)
      hue-rotate(300deg)
      brightness(120%)
      contrast(90%);
  	}
    .filter-gray {
      filter: 
        brightness(0) 
        saturate(100%) 
        invert(55%)
        sepia(0%) 
        saturate(0%) 
        hue-rotate(0deg) 
        brightness(95%) 
        contrast(115%);
    }
    .custom-play svg path {
    fill: #75BCE1;
  }
    .font-bold {
      font-family: 'Noto Sans JP', sans-serif;
      font-weight: 400;
    }
    .font-header {
      font-family: 'Noto Sans JP', sans-serif;
      font-weight: 520;
    }
    .font-meta {
      font-family: 'Noto Sans JP', sans-serif;
    }
    .font-text {
      font-family: 'Noto Sans JP', sans-serif;
      line-height: 5.5dvw;
      leading-trim: both;
    }
    .bubble {
      position: relative;
      background: #F6F6F6 !important;
  	margin-left: 4.25926dvw;
    }
  
    .bubble::before {
      content: "";
      position: absolute;
      top: 1.5dvw;
      left: -2.45dvw;
      width: 0;
      height: 0;
      border-top: 0px solid transparent;
      border-bottom: 2.85dvw solid transparent;
      border-right: 2.5dvw solid #F6F6F6 !important;
    }
  </style>
  <style>
  input[type="range"].custom-seek::-webkit-slider-thumb { appearance: none; height: 3.7dvw; width: 3.7dvw;
      background: #75BCE1; border-radius: 9999px; cursor: pointer; margin-top: 0px; } input[type="range"].custom-seek::-moz-range-thumb { height: 3.7dvw; width: 3.7dvw;
      background: #9F9F9F; border-radius: 9999px; cursor: pointer; }
  </style>
</head>

<body class="bg-white min-h-[100dvh] flex flex-col items-start">
  <div class="fixed top-0 w-full z-50 flex items-center justify-between px-[4.25926dvw] h-[12.68519dvw] text-white" style="background: linear-gradient(to left, #a77acf, #86cfe8);">
    <div class="translate-y-[0px]">
      <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="w-[6.51852dvw] h-[6.51852dvw] -ml-[1.1dvw] hover:opacity-90 transition filter-white norightclick" aria-label="戻る" role="img">
        <rect fill="none" width="24" height="24">
        </rect>
        <path fill="#9F9F9F" d="M16.4,22.2c-0.2,0-0.4-0.1-0.6-0.2l-9.2-9.2c-0.2-0.1-0.2-0.4-0.2-0.6c0-0.2,0.1-0.4,0.2-0.6l9.2-9.2
      c0.3-0.3,0.8-0.3,1.1,0c0.3,0.3,0.3,0.8,0,1.1l-8.6,8.6l8.6,8.6c0.3,0.3,0.3,0.8,0,1.1C16.8,22.1,16.6,22.2,16.4,22.2z">
        </path>
      </svg>
    </div>
    <div class="absolute inset-0 flex items-center pointer-events-none translate-y-[0px]">
      <span class="font-header ml-[16.7dvw] text-[4.28dvw] tracking-[0.05dvw] text-left">ROOM_NAME</span>
    </div>
    <div class="flex items-center space-x-[7.2dvw] translate-y-[0px]">
      <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="w-[6.41852dvw] h-[6.41852dvw] hover:opacity-90 transition filter-white norightclick" aria-label="メッセージ" role="img">
        <rect y="0" fill="none" width="24" height="24">
        </rect>
        <path fill="#9F9F9F" d="M22.09,4.6H1.89c-0.79,0-1.42,0.6-1.42,1.34v12.33c0,0.74,0.64,1.34,1.42,1.34h20.2
      c0.79,0,1.42-0.6,1.42-1.34V5.94C23.52,5.2,22.88,4.6,22.09,4.6z M20.63,5.94l-8.64,8.1l-8.64-8.1H20.63z M1.89,18.26V6.45l9.6,9
      c0.14,0.13,0.32,0.2,0.5,0.2c0.18,0,0.36-0.07,0.5-0.2l9.6-9v11.81H1.89z">
        </path>
      </svg>
      <button onclick="openNameModal()" class="text-white">
        <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 32 32" class="w-[4.6dvw] h-[4.6dvw] hover:opacity-90 transition filter-white norightclick" aria-label="メニュー" role="img">
          <rect fill="none" width="32" height="32">
          </rect>
          <g transform="translate(4)">
            <circle fill="#9F9F9F" cx="0.6" cy="16.3" r="3.4">
            </circle>
            <circle fill="#9F9F9F" cx="12" cy="16.3" r="3.4">
            </circle>
            <circle fill="#9F9F9F" cx="23.4" cy="16.3" r="3.4">
            </circle>
          </g>
        </svg>
      </button>
    </div>
  </div>
  <div class="w-full max-w-full pt-[6.38889dvw] mt-[12.68519dvw]">
  </div>
  <div class="w-full px-[4.25926dvw] space-y-[9.25926dvw]">
    <div class="contents">
      <div id="msg-2000-01-01" class="invisible h-0 p-0 m-0 overflow-hidden -mt-[9.25926dvw]">
      </div>
    </div>
	  <!-- チャットエリア -->
    <div class="contents">
      <div id="msg-2100-01-01" class="invisible h-0 p-0 m-0 overflow-hidden mt-[9.25926dvw]">
      </div>
    </div>
  </div>
  <div id="imageModal" class="fixed inset-0 bg-[#363636] bg-opacity-100 flex items-center justify-center z-[999] hidden">
    <button onclick="closeImageModal()" class="absolute top-[0dvw] right-[1dvw] p-[5dvw] z-50 hover:opacity-70 transition">
      <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="w-[4.07407dvw] h-[4.07407dvw] filter-white norightclick" aria-label="閉じる" role="img">
        <rect fill="none" width="24" height="24">
        </rect>
        <path fill="#9F9F9F" d="M13.6,12l8.1-8.1c0.43-0.43,0.43-1.14,0-1.57c-0.43-0.43-1.14-0.43-1.57,0l-8.1,8.1l-8.1-8.1
      c-0.43-0.43-1.14-0.43-1.57,0c-0.43,0.43-0.43,1.14,0,1.57l8.1,8.1l-8.1,8.1c-0.43,0.43-0.43,1.14,0,1.57
      C2.56,21.88,2.84,22,3.14,22c0.29,0,0.58-0.12,0.79-0.33l8.1-8.1l8.1,8.1c0.21,0.21,0.49,0.33,0.79,0.33c0.29,0,0.58-0.12,0.79-0.33
      c0.43-0.43,0.43-1.14,0-1.57L13.6,12z">
        </path>
      </svg>
    </button>
    <img id="modalImage" src="" alt="拡大画像" class="w-full h-full modal-media object-contain rounded-none z-40 select-none shadow-lg" oncontextmenu="return false" ondragstart="return false" onmousedown="return false" draggable="false">
  </div>
  <div id="videoModal" class="fixed inset-0 bg-[#363636] bg-opacity-100 flex items-center justify-center z-[999] hidden">
    <button onclick="closeVideoModal()" class="absolute top-[0] right-[1dvw] z-50 p-[5dvw] hover:opacity-70 transition">
      <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="w-[4.07407dvw] h-[4.07407dvw] filter-white norightclick" aria-label="閉じる" role="img">
        <rect fill="none" width="24" height="24">
        </rect>
        <path fill="#9F9F9F" d="M13.6,12l8.1-8.1c0.43-0.43,0.43-1.14,0-1.57c-0.43-0.43-1.14-0.43-1.57,0l-8.1,8.1l-8.1-8.1
      c-0.43-0.43-1.14-0.43-1.57,0c-0.43,0.43-0.43,1.14,0,1.57l8.1,8.1l-8.1,8.1c-0.43,0.43-0.43,1.14,0,1.57
      C2.56,21.88,2.84,22,3.14,22c0.29,0,0.58-0.12,0.79-0.33l8.1-8.1l8.1,8.1c0.21,0.21,0.49,0.33,0.79,0.33c0.29,0,0.58-0.12,0.79-0.33
      c0.43-0.43,0.43-1.14,0-1.57L13.6,12z">
        </path>
      </svg>
    </button>
    <div class="relative w-full h-full flex items-center justify-center">
      <video id="modalVideo" class="w-full h-full object-contain z-40 select-none" controlslist="nodownload" oncontextmenu="return false" draggable="false" ondragstart="return false" onmousedown="return false">
        <source src="" type="video/mp4">お使いのブラウザは動画再生に対応していません。</source>
      </video>
      <div id="videoOverlay" class="absolute inset-0 bg-black opacity-0 pointer-events-none transition-opacity duration-300 z-40">
      </div>
      <div id="videoControls" class="absolute inset-0 flex flex-col justify-center items-center
            opacity-0 pointer-events-none transition-opacity duration-300 z-50">
        <div class="flex items-center space-x-[18dvw]">
          <button onclick="seekVideo(-5)" class="bg-black bg-opacity-0 p-0 rounded-full hover:bg-opacity-0 transition">
            <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="w-[6.48148dvw] h-[6.48148dvw] filter-white norightclick" aria-label="5秒戻し" role="img">
              <rect y="0" fill="none" width="24" height="24">
              </rect>
              <rect x="0" y="0" fill="none" width="24" height="24">
              </rect>
              <path fill="#9F9F9F" d="M7.86,4.33l5.21,3.28c0.27,0.17,0.61-0.02,0.61-0.34V0.71c0-0.31-0.35-0.51-0.61-0.34L7.86,3.65
      C7.61,3.81,7.61,4.17,7.86,4.33z">
              </path>
              <path fill="none" stroke="#9F9F9F" stroke-width="1.8" stroke-linecap="round" stroke-miterlimit="10" d="M11.37,4.02
      C11.58,4.01,11.79,4,12,4c5.25,0,9.5,4.25,9.5,9.5S17.25,23,12,23s-9.5-4.25-9.5-9.5c0-2.64,1.08-5.03,2.82-6.75">
              </path>
              <text transform="matrix(1 0 0 1 9.105 18.3716)" fill="#9F9F9F" font-family="'SSTJapanese-Bold'" font-size="10.4px">5</text>
            </svg>
          </button>
          <button onclick="togglePlay()" class="bg-opacity-0 rounded-full hover:bg-opacity-0 transition">
            <div id="playPauseIcon" class="w-[7dvw] h-[7dvw] flex items-center justify-center">
              <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="w-20 h-20 filter-white norightclick" aria-label="再生" role="img">
                <rect y="0" fill="none" width="24" height="24">
                </rect>
                <path fill="#9F9F9F" d="M22.94,12L1.61,24V0L22.94,12z">
                </path>
              </svg>
            </div>
          </button>
          <button onclick="seekVideo(5)" class="bg-black bg-opacity-0 p-0 rounded-full hover:bg-opacity-0 transition">
            <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="w-[6.48148dvw] h-[6.48148dvw] filter-white norightclick" aria-label="5秒進み" role="img">
              <rect y="0" fill="none" width="24" height="24">
              </rect>
              <rect x="0" y="0" fill="none" width="24" height="24">
              </rect>
              <path fill="#9F9F9F" d="M16.14,4.33l-5.21,3.28c-0.27,0.17-0.61-0.02-0.61-0.34V0.71c0-0.31,0.35-0.51,0.61-0.34l5.21,3.28
      C16.39,3.81,16.39,4.17,16.14,4.33z">
              </path>
              <path fill="none" stroke="#9F9F9F" stroke-width="1.8" stroke-linecap="round" stroke-miterlimit="10" d="M12.63,4.02
      C12.42,4.01,12.21,4,12,4c-5.25,0-9.5,4.25-9.5,9.5S6.75,23,12,23s9.5-4.25,9.5-9.5c0-2.64-1.08-5.03-2.82-6.75">
              </path>
              <text transform="matrix(1 0 0 1 9.105 18.3716)" fill="#9F9F9F" font-family="'SSTJapanese-Bold'" font-size="10.4px">5</text>
            </svg>
          </button>
        </div>
        <div class="absolute top-[80%] left-1/2 -translate-x-1/2 mt-[10dvw] w-[85dvw] z-[60] flex flex-col space-y-[8dvw] pointer-events-auto">
          <input type="range" id="videoSeek" class="custom-seek w-full h-[0.5dvw] bg-gray-200 rounded-lg appearance-none cursor-pointer">
          <div class="flex items-center text-white">
            <svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="w-[6.48148dvw] h-[6.48148dvw] filter-white norightclick" aria-label="オーディオ" role="img">
              <rect x="4.79" y="4.83" fill="none" width="14.38" height="14.38">
              </rect>
              <rect x="-0.02" y="0.02" fill="none" width="24" height="24">
              </rect>
              <path fill="#9F9F9F" d="M1.94,9.75v4.85c0,0.36,0.3,0.66,0.66,0.66h2.77c0.52,0,1.03,0.17,1.44,0.5l3.75,2.93
      c0.37,0.28,0.9,0.02,0.9-0.44V6.1c0-0.46-0.53-0.72-0.9-0.44L6.82,8.59C6.4,8.91,5.9,9.09,5.37,9.09H2.6
      C2.24,9.09,1.94,9.39,1.94,9.75z">
              </path>
              <path fill="#9F9F9F" d="M17.62,21.24c0.09,0.15,0.23,0.25,0.4,0.28c0.17,0.04,0.34,0,0.48-0.09c1.23-0.84,2.27-2.13,3.01-3.72
      c0.77-1.65,1.16-3.56,1.16-5.52c0-1.98-0.41-3.89-1.18-5.54c-0.74-1.6-1.8-2.89-3.04-3.72c-0.14-0.09-0.31-0.13-0.48-0.09
      c-0.15,0.02-0.29,0.12-0.38,0.27l-0.35,0.55c-0.18,0.29-0.1,0.66,0.18,0.85c0.98,0.66,1.82,1.73,2.42,3.08
      c0.62,1.38,0.94,2.98,0.94,4.61c0,1.62-0.32,3.2-0.93,4.58c-0.59,1.35-1.42,2.42-2.39,3.08c-0.27,0.19-0.36,0.56-0.18,0.84
      L17.62,21.24z">
              </path>
              <path fill="#9F9F9F" d="M15.14,17.23c0.1,0.17,0.28,0.27,0.48,0.3c0.2,0.02,0.39-0.05,0.52-0.21C17.32,16,18,14.12,18,12.18
      c0-2-0.71-3.9-1.94-5.23c-0.13-0.14-0.31-0.21-0.51-0.2c-0.2,0.02-0.37,0.12-0.48,0.29l-0.34,0.55c-0.15,0.23-0.12,0.53,0.05,0.74
      c0.84,0.99,1.31,2.4,1.31,3.85c0,1.41-0.46,2.8-1.26,3.79c-0.16,0.2-0.18,0.49-0.04,0.71L15.14,17.23z">
              </path>
            </svg>
            <span id="videoTime" class="text-[3.5vw] pl-[4dvw] font-meta">00:00/00:00</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="nameChangeModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[1000] hidden">
    <div class="bg-white p-[5dvw] rounded shadow-md space-y-[3dvw] text-center max-w-[70dvw] w-full">
      <h2 class="text-[2.5dvw] text-[#75BCE1] font-bold">呼ばれたい名前を変更</h2>
      <input id="newUsername" type="text" placeholder="新しい名前を入力" class="border px-[3dvw] py-[1.5dvw] rounded w-full text-[2dvw] font-meta focus:outline-[#75BCE1]">
      <div class="flex justify-end space-x-4">
        <button onclick="closeNameModal()" class="px-[2dvw] py-[1dvw] text-[2dvw] font-meta bg-gray-300 rounded hover:bg-gray-400">キャンセル</button>
        <button onclick="updateUsername()" class="px-[2dvw] py-[1dvw] text-[2dvw] font-meta bg-[#75BCE1] text-white rounded hover:bg-blue-400">保存</button>
      </div>
    </div>
  </div>
  <script>
  document.addEventListener("DOMContentLoaded", function () {
      let username = localStorage.getItem("username");
      if (!username) {
		  username = "正恭";
        localStorage.setItem("username", username);
      }
      applyUsername(username);
    });
  
    function applyUsername(name) {
      document.querySelectorAll(".bubble p").forEach((bubble) => {
        bubble.innerHTML = bubble.innerHTML.replace(/%%%|％％％/g, name);
      });
    }
  
    function openNameModal() {
      document.getElementById("nameChangeModal").classList.remove("hidden");
    }
  
    function closeNameModal() {
      document.getElementById("nameChangeModal").classList.add("hidden");
    }
  
    function updateUsername() {
      const input = document.getElementById("newUsername");
      const newName = input.value.trim() || "正恭";
      localStorage.setItem("username", newName);
      closeNameModal();
      location.reload();
    }
  
    function openImageModal(src) {
      const modal = document.getElementById("imageModal");
      const modalImg = document.getElementById("modalImage");
      modalImg.src = src;
      modal.classList.remove("hidden");
      document.body.classList.add("overflow-hidden");
    }
  
    function closeImageModal() {
      const modal = document.getElementById("imageModal");
      const modalImg = document.getElementById("modalImage");
      modal.classList.add("hidden");
      modalImg.src = "";
      document.body.classList.remove("overflow-hidden");
    }
  
  
  
    function closeVideoModal() {
      const modal = document.getElementById("videoModal");
      const video = document.getElementById("modalVideo");
  
      video.pause();
      video.currentTime = 0;
      video.removeAttribute("src");
      modal.classList.add("hidden");
      document.body.classList.remove("overflow-hidden");
    }
  
    window.addEventListener("load", function () {
      const savedScroll = localStorage.getItem("scrollPosition");
      if (savedScroll !== null) {
        window.scrollTo(0, parseInt(savedScroll));
      } else {
        setTimeout(() => {
          window.scrollTo(0, document.body.scrollHeight);
        }, 10);
      }
    });
  
    window.addEventListener("scroll", function () {
      localStorage.setItem("scrollPosition", window.scrollY);
    });
  </script>
  <script>
  let allAudios = [];
  
  document.querySelectorAll(".custom-audio-player").forEach((player) => {
    const audio = new Audio(player.dataset.audioSrc);
    allAudios.push(audio);
  
    const playBtn = player.querySelector(".custom-play");
    const icon = playBtn.querySelector(".audio-icon");
    const seek = player.querySelector(".custom-seek");
    const timeDisplay = player.querySelector(".custom-time");
    let isPlaying = false;
  
    playBtn.addEventListener("click", () => {
      if (isPlaying) {
        audio.pause();
      } else {
        allAudios.forEach(a => {
          if (a !== audio) {
            a.pause();
          }
        });
        audio.play();
      }
    });
  
    audio.addEventListener("play", () => {
    isPlaying = true;
    icon.innerHTML = `
      <svg version="1.1" id="レイヤー_1"
           xmlns="http://www.w3.org/2000/svg"
           viewBox="0 0 24 24"
           class="w-full h-full">
        <rect y="0" fill="none" width="24" height="24"/>
        <g id="グループ_680" transform="translate(-180 -619)">
          <rect id="長方形_303" x="181.45" y="619" fill="#9F9F9F" width="8" height="24"/>
          <rect id="長方形_304" x="194.45" y="619" fill="#9F9F9F" width="8" height="24"/>
        
      
    `;
  });
  
    audio.addEventListener("pause", () => {
    isPlaying = false;
    icon.innerHTML = `
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
           class="w-full h-full">
        <path fill="#FFFFFF" d="M22.94,12L1.61,24V0L22.94,12z"/>
      
    `;
  });
  
    audio.addEventListener("timeupdate", () => {
      const current = audio.currentTime;
      const duration = audio.duration;
      seek.value = (current / duration) * 100 || 0;
      timeDisplay.textContent = formatTime(current);
    });
  
    seek.addEventListener("input", () => {
      audio.currentTime = (seek.value / 100) * audio.duration;
    });
  
    function formatTime(sec) {
      const min = Math.floor(sec / 60);
      const s = Math.floor(sec % 60);
      return `${String(min).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
    }
  });
  </script>
  <script>
  function enableSwipeOnMedia(modalId, mediaSelector, closeFunc) {
    const modal = document.getElementById(modalId);
    let startY = 0, currentY = 0, isDragging = false, hasMovedEnough = false;
    const swipeThreshold = 300, startSwipeThreshold = 50;
  
    const handleStart = (e) => {
      const clientY = e.touches ? e.touches[0].clientY : e.clientY;
      startY = clientY;
      currentY = startY;
      isDragging = true;
      hasMovedEnough = false;
      modal.style.transition = "none";
    };
  
    const handleMove = (e) => {
      if (!isDragging) return;
      const clientY = e.touches ? e.touches[0].clientY : e.clientY;
      currentY = clientY;
      const deltaY = currentY - startY;
      if (deltaY > startSwipeThreshold) {
        hasMovedEnough = true;
        modal.style.transform = `translateY(${deltaY}px)`;
      }
    };
  
    const handleEnd = () => {
      if (!isDragging) return;
      isDragging = false;
      const deltaY = currentY - startY;
      modal.style.transition = "transform 0.3s ease";
  
      if (hasMovedEnough && deltaY > swipeThreshold) {
        modal.style.transform = `translateY(100vh)`;
        setTimeout(() => {
          modal.style.transform = "";
          modal.style.transition = "";
          closeFunc();
        }, 300);
      } else {
        modal.style.transform = "translateY(0)";
        setTimeout(() => {
          modal.style.transition = "";
        }, 300);
      }
    };
  
    modal.addEventListener("touchstart", handleStart, { passive: true });
    modal.addEventListener("touchmove", handleMove, { passive: false });
    modal.addEventListener("touchend", handleEnd);
  
    modal.addEventListener("mousedown", handleStart);
    modal.addEventListener("mousemove", handleMove);
    modal.addEventListener("mouseup", handleEnd);
    modal.addEventListener("mouseleave", handleEnd);
  }
  
  document.addEventListener("DOMContentLoaded", () => {
    enableSwipeOnMedia("imageModal", "#modalImage", closeImageModal);
    enableSwipeOnMedia("videoModal", "#modalVideo", closeVideoModal);
  
    let activeModal = null;
  
    function preventPullToRefresh(e) {
      if (activeModal && e.touches.length === 1 && e.touches[0].clientY > 0) {
        e.preventDefault();
      }
    }
  
    document.addEventListener("touchstart", (e) => {
      const imageOpen = !document.getElementById("imageModal").classList.contains("hidden");
      const videoOpen = !document.getElementById("videoModal").classList.contains("hidden");
  
      activeModal = imageOpen || videoOpen;
    }, { passive: false });
  
    document.addEventListener("touchmove", preventPullToRefresh, { passive: false });
  });
  </script>
  <script>
  let hasBeenTapped = false;
    const modalVideo = document.getElementById("modalVideo");
    const videoSeek = document.getElementById("videoSeek");
    const videoTime = document.getElementById("videoTime");
    const playPauseIcon = document.getElementById("playPauseIcon");
    const videoControls = document.getElementById("videoControls");
    const videoModal = document.getElementById("videoModal");
  
    let uiTimeout;
  
    function openVideoModal(src) {
      modalVideo.src = src;
      videoModal.classList.remove("hidden");
      document.body.classList.add("overflow-hidden");
      modalVideo.muted = false;
      modalVideo.play();
    }
  
    function closeVideoModal() {
      modalVideo.pause();
      modalVideo.currentTime = 0;
      modalVideo.removeAttribute("src");
      videoModal.classList.add("hidden");
      document.body.classList.remove("overflow-hidden");
    }
  
    function togglePlay() {
      if (modalVideo.paused) {
        modalVideo.play();
      } else {
        modalVideo.pause();
      }
    }
  
    function seekVideo(seconds) {
      modalVideo.currentTime += seconds;
      showControlsTemporarily();
    }
  
    modalVideo.addEventListener("play", () => {
  playPauseIcon.innerHTML = `
<svg version="1.1"
     xmlns="http://www.w3.org/2000/svg"
     xmlns:xlink="http://www.w3.org/1999/xlink"
     viewBox="0 0 24 24"
     xml:space="preserve"
     class="w-20 h-20 filter-white norightclick">

  <rect y="0" fill="none" width="24" height="24"/>

  <defs>
    <rect id="SVGID_1_" y="0" width="24" height="24"/>
    <clipPath id="clip_pause">
      <use xlink:href="#SVGID_1_"/>
    </clipPath>
  </defs>

  <g clip-path="url(#clip_pause)">
    <g transform="translate(-180 -619)">
      <rect x="181.45" y="619" fill="#9F9F9F" width="8" height="24"/>
      <rect x="194.45" y="619" fill="#9F9F9F" width="8" height="24"/>
    </g>
  </g>

</svg>
`;
});

  
  modalVideo.addEventListener("pause", () => {
  playPauseIcon.innerHTML = `
<svg version="1.1"
     xmlns="http://www.w3.org/2000/svg"
     xmlns:xlink="http://www.w3.org/1999/xlink"
     viewBox="0 0 24 24"
     xml:space="preserve"
     class="w-20 h-20 filter-white norightclick">

  <rect y="0" fill="none" width="24" height="24"/>

  <defs>
    <rect id="SVGID_2_" y="0" width="24" height="24"/>
    <clipPath id="clip_play">
      <use xlink:href="#SVGID_2_"/>
    </clipPath>
  </defs>

  <g clip-path="url(#clip_play)">
    <path fill="#9F9F9F" d="M22.94,12L1.61,24V0L22.94,12z"/>
  </g>

</svg>
`;
});
  
    modalVideo.addEventListener("timeupdate", () => {
      const current = modalVideo.currentTime;
      const duration = modalVideo.duration || 1;
      videoSeek.value = (current / duration) * 100;
      videoTime.textContent = `${formatTime(current)} / ${formatTime(duration)}`;
    });
  
    videoSeek.addEventListener("input", () => {
      const duration = modalVideo.duration || 1;
      modalVideo.currentTime = (videoSeek.value / 100) * duration;
      showControlsTemporarily();
    });
  
    function formatTime(sec) {
      const m = Math.floor(sec / 60);
      const s = Math.floor(sec % 60);
      return `${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
    }
  
    function showControlsTemporarily() {
    videoControls.classList.remove("opacity-0", "pointer-events-none");
    videoControls.classList.add("opacity-100", "pointer-events-auto");
  
    document.getElementById("videoOverlay").classList.remove("opacity-0", "pointer-events-none");
    document.getElementById("videoOverlay").classList.add("opacity-50");
  
    if (uiTimeout) clearTimeout(uiTimeout);
    uiTimeout = setTimeout(() => {
      videoControls.classList.remove("opacity-100", "pointer-events-auto");
      videoControls.classList.add("opacity-0", "pointer-events-none");
  
      document.getElementById("videoOverlay").classList.remove("opacity-50");
      document.getElementById("videoOverlay").classList.add("opacity-0", "pointer-events-none");
    }, 1500);
  }
  
    modalVideo.addEventListener("click", () => {
    if (!hasBeenTapped) {
      hasBeenTapped = true;
    }
    showControlsTemporarily();
  });
  </script>
  <script>
  function toggleDateJumpMenu() {
    const menu = document.getElementById("dateJumpMenu");
    menu.classList.toggle("hidden");
  }
  </script>
  <script>
  document.querySelectorAll(".bubble p").forEach(p => {
  let html = p.innerHTML;

  const urlRegex = /(https?:\/\/[^\s<]+)|(www\.[^\s<]+)/g;

  html = html.replace(urlRegex, rawUrl => {
    const trailing = /[)、。.】＞＞」』\]\)\s！!？?]*$/;

    const urlWithoutTrailing = rawUrl.replace(trailing, "");
    const removed = rawUrl.slice(urlWithoutTrailing.length);

    const safeURL = urlWithoutTrailing.startsWith("http")
                    ? urlWithoutTrailing
                    : "https://" + urlWithoutTrailing;

    return `<a href="${safeURL}" class="inline-block underline break-all" style="color:#7EC0E2;">${urlWithoutTrailing}</a>${removed}`;
  });

  p.innerHTML = html;
});
  </script>
</body>

</html>